@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}
@using Syncfusion.EJ2;
@{
    var TitleFont = new Syncfusion.EJ2.CircularGauge.CircularGaugeFont
    {
        Size = "24px"
    };
}

<div class="text-center">
    <h1 class="display-4">Fronius Symo 8.2-3-M</h1>
</div>

<div class="row">
    <div class="col-sm-4 col-xs-1">
        <div class="content-wrapper">
            <ejs-circulargauge id="Gauge01" title="Current L1" titleStyle="TitleFont">
                <e-circulargauge-axes>
                    <e-circulargauge-axis minimum="0" maximum="10">
                        <e-axis-annotations>
                            <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                        </e-axis-annotations>
                        <e-axis-minorticks color="transparent"></e-axis-minorticks>
                    </e-circulargauge-axis>
                </e-circulargauge-axes>
            </ejs-circulargauge>
        </div>
    </div>

    <div class="col-sm-4 col-xs-1">
        <div class="content-wrapper">
            <ejs-circulargauge id="Gauge02" title="Current L2" titleStyle="TitleFont">
                <e-circulargauge-axes>
                    <e-circulargauge-axis minimum="0" maximum="10">
                        <e-axis-annotations>
                            <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                        </e-axis-annotations>
                        <e-axis-minorticks color="transparent"></e-axis-minorticks>
                    </e-circulargauge-axis>
                </e-circulargauge-axes>
            </ejs-circulargauge>
        </div>
    </div>

    <div class="col-sm-4 col-xs-1">
        <div class="content-wrapper">
            <ejs-circulargauge id="Gauge03" title="Current L3" titleStyle="TitleFont">
                <e-circulargauge-axes>
                    <e-circulargauge-axis minimum="0" maximum="10">
                        <e-axis-annotations>
                            <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                        </e-axis-annotations>
                        <e-axis-minorticks color="transparent"></e-axis-minorticks>
                    </e-circulargauge-axis>
                </e-circulargauge-axes>
            </ejs-circulargauge>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-sm-4 col-xs-1">
        <div class="content-wrapper">
            <ejs-circulargauge id="Gauge04" title="Voltage L1N" titleStyle="TitleFont">
                <e-circulargauge-axes>
                    <e-circulargauge-axis minimum="0" maximum="250">
                        <e-axis-annotations>
                            <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                        </e-axis-annotations>
                        <e-axis-minorticks color="transparent"></e-axis-minorticks>
                    </e-circulargauge-axis>
                </e-circulargauge-axes>
            </ejs-circulargauge>
        </div>
    </div>

    <div class="col-sm-4 col-xs-1">
        <div class="content-wrapper">
            <ejs-circulargauge id="Gauge05" title="Voltage L2N" titleStyle="TitleFont">
                <e-circulargauge-axes>
                    <e-circulargauge-axis minimum="0" maximum="250">
                        <e-axis-annotations>
                            <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                        </e-axis-annotations>
                        <e-axis-minorticks color="transparent"></e-axis-minorticks>
                    </e-circulargauge-axis>
                </e-circulargauge-axes>
            </ejs-circulargauge>
        </div>
    </div>

    <div class="col-sm-4 col-xs-1">
        <div class="content-wrapper">
            <ejs-circulargauge id="Gauge06" title="Voltage L3N" titleStyle="TitleFont">
                <e-circulargauge-axes>
                    <e-circulargauge-axis minimum="0" maximum="250">
                        <e-axis-annotations>
                            <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                        </e-axis-annotations>
                        <e-axis-minorticks color="transparent"></e-axis-minorticks>
                    </e-circulargauge-axis>
                </e-circulargauge-axes>
            </ejs-circulargauge>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-sm-4 col-xs-1">
        <div class="content-wrapper">
            <ejs-circulargauge id="Gauge07" title="Voltage L1L2" titleStyle="TitleFont">
                <e-circulargauge-axes>
                    <e-circulargauge-axis minimum="0" maximum="500">
                        <e-axis-annotations>
                            <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                        </e-axis-annotations>
                        <e-axis-minorticks color="transparent"></e-axis-minorticks>
                    </e-circulargauge-axis>
                </e-circulargauge-axes>
            </ejs-circulargauge>
        </div>
    </div>

    <div class="col-sm-4 col-xs-1">
        <div class="content-wrapper">
            <ejs-circulargauge id="Gauge08" title="Voltage L2L3" titleStyle="TitleFont">
                <e-circulargauge-axes>
                    <e-circulargauge-axis minimum="0" maximum="500">
                        <e-axis-annotations>
                            <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                        </e-axis-annotations>
                        <e-axis-minorticks color="transparent"></e-axis-minorticks>
                    </e-circulargauge-axis>
                </e-circulargauge-axes>
            </ejs-circulargauge>
        </div>
    </div>

    <div class="col-sm-4 col-xs-1">
        <div class="content-wrapper">
            <ejs-circulargauge id="Gauge09" title="Voltage L3L1" titleStyle="TitleFont">
                <e-circulargauge-axes>
                    <e-circulargauge-axis minimum="0" maximum="500">
                        <e-axis-annotations>
                            <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                        </e-axis-annotations>
                        <e-axis-minorticks color="transparent"></e-axis-minorticks>
                    </e-circulargauge-axis>
                </e-circulargauge-axes>
            </ejs-circulargauge>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-sm-4 col-xs-1">
        <div class="content-wrapper">
            <ejs-circulargauge id="Gauge10" title="Apparent Power" titleStyle="TitleFont">
                <e-circulargauge-axes>
                    <e-circulargauge-axis minimum="0" maximum="10">
                        <e-axis-annotations>
                            <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                        </e-axis-annotations>
                        <e-axis-minorticks color="transparent"></e-axis-minorticks>
                    </e-circulargauge-axis>
                </e-circulargauge-axes>
            </ejs-circulargauge>
        </div>
    </div>

    <div class="col-sm-4 col-xs-1">
        <div class="content-wrapper">
            <ejs-circulargauge id="Gauge11" title="Active Power" titleStyle="TitleFont">
                <e-circulargauge-axes>
                    <e-circulargauge-axis minimum="0" maximum="10">
                        <e-axis-annotations>
                            <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                        </e-axis-annotations>
                        <e-axis-minorticks color="transparent"></e-axis-minorticks>
                    </e-circulargauge-axis>
                </e-circulargauge-axes>
            </ejs-circulargauge>
        </div>
    </div>

    <div class="col-sm-4 col-xs-1">
        <div class="content-wrapper">
            <ejs-circulargauge id="Gauge12" title="Reactive Power" titleStyle="TitleFont">
                <e-circulargauge-axes>
                    <e-circulargauge-axis minimum="0" maximum="10">
                        <e-axis-annotations>
                            <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                        </e-axis-annotations>
                        <e-axis-minorticks color="transparent"></e-axis-minorticks>
                    </e-circulargauge-axis>
                </e-circulargauge-axes>
            </ejs-circulargauge>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-sm-4 col-xs-1">
        <div class="content-wrapper">
            <ejs-circulargauge id="Gauge13" title="Power Factor" titleStyle="TitleFont">
                <e-circulargauge-axes>
                    <e-circulargauge-axis minimum="-1" maximum="1">
                        <e-axis-annotations>
                            <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                        </e-axis-annotations>
                        <e-axis-minorticks color="transparent"></e-axis-minorticks>
                    </e-circulargauge-axis>
                </e-circulargauge-axes>
            </ejs-circulargauge>
        </div>
    </div>

    <div class="col-sm-4 col-xs-1">
        <div class="content-wrapper">
            <ejs-circulargauge id="Gauge14" title="Frequency" titleStyle="TitleFont">
                <e-circulargauge-axes>
                    <e-circulargauge-axis minimum="48" maximum="52">
                        <e-axis-annotations>
                            <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                        </e-axis-annotations>
                        <e-axis-minorticks color="transparent"></e-axis-minorticks>
                    </e-circulargauge-axis>
                </e-circulargauge-axes>
            </ejs-circulargauge>
        </div>
    </div>

    <div class="col-sm-4 col-xs-1">
        <div class="content-wrapper">
            <ejs-circulargauge id="Gauge15" title="Lifetime Energy" titleStyle="TitleFont">
                <e-circulargauge-axes>
                    <e-circulargauge-axis minimum="0" maximum="30">
                        <e-axis-annotations>
                            <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                        </e-axis-annotations>
                        <e-axis-minorticks color="transparent"></e-axis-minorticks>
                    </e-circulargauge-axis>
                </e-circulargauge-axes>
            </ejs-circulargauge>
        </div>
    </div>
</div>

@section Scripts
    {
    <script src="~/lib/signalr/signalr.js"></script>
    <script>
        var gauge1, gauge2, gauge3
        var gauge4, gauge5, gauge6
        var gauge7, gauge8, gauge9
        var gauge10, gauge11, gauge12
        var gauge13, gauge14, gauge15

        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/hubs/monitor")
            .configureLogging(signalR.LogLevel.Trace)
            .build();

        connection.on('UpdateInverter', function (data) {
            if (!gauge1)
                gauge1 = document.getElementById("Gauge01").ej2_instances[0];
            if (!gauge2)
                gauge2 = document.getElementById("Gauge02").ej2_instances[0];
            if (!gauge3)
                gauge3 = document.getElementById("Gauge03").ej2_instances[0];
            if (!gauge4)
                gauge4 = document.getElementById("Gauge04").ej2_instances[0];
            if (!gauge5)
                gauge5 = document.getElementById("Gauge05").ej2_instances[0];
            if (!gauge6)
                gauge6 = document.getElementById("Gauge06").ej2_instances[0];
            if (!gauge7)
                gauge7 = document.getElementById("Gauge07").ej2_instances[0];
            if (!gauge8)
                gauge8 = document.getElementById("Gauge08").ej2_instances[0];
            if (!gauge9)
                gauge9 = document.getElementById("Gauge09").ej2_instances[0];
            if (!gauge10)
                gauge10 = document.getElementById("Gauge10").ej2_instances[0];
            if (!gauge11)
                gauge11 = document.getElementById("Gauge11").ej2_instances[0];
            if (!gauge12)
                gauge12 = document.getElementById("Gauge12").ej2_instances[0];
            if (!gauge13)
                gauge13 = document.getElementById("Gauge13").ej2_instances[0];
            if (!gauge14)
                gauge14 = document.getElementById("Gauge14").ej2_instances[0];
            if (!gauge15)
                gauge15 = document.getElementById("Gauge15").ej2_instances[0];

            value01 = (data.currentL1 === "NaN") ? 0 : data.currentL1;
            value02 = (data.currentL2 === "NaN") ? 0 : data.currentL2;
            value03 = (data.currentL3 === "NaN") ? 0 : data.currentL3;
            value04 = (data.voltageL1N === "NaN") ? 0 : data.voltageL1N;
            value05 = (data.voltageL2N === "NaN") ? 0 : data.voltageL2N;
            value06 = (data.voltageL3N === "NaN") ? 0 : data.voltageL3N;
            value07 = (data.voltageL1L2 === "NaN") ? 0 : data.voltageL1L2;
            value08 = (data.voltageL2L3 === "NaN") ? 0 : data.voltageL2L3;
            value09 = (data.voltageL3L1 === "NaN") ? 0 : data.voltageL3L1;
            value10 = (data.apparentPower === "NaN") ? 0 : data.apparentPower / 1000.0;
            value11 = (data.powerAC === "NaN") ? 0 : data.powerAC / 1000.0;
            value12 = (data.reactivePower === "NaN") ? 0 : data.reactivePower / 1000.0;
            value13 = (data.powerFactor === "NaN") ? 0 : data.powerFactor;
            value14 = (data.frequency === "NaN") ? 0 : data.frequency;
            value15 = (data.lifeTimeEnergy === "NaN") ? 0 : data.lifeTimeEnergy / 1000000.0;

            gauge1.setAnnotationValue(0, 0, "<text class='h4'>" + value01.toFixed(2) + " A</text>");
            gauge2.setAnnotationValue(0, 0, "<text class='h4'>" + value02.toFixed(2) + " A</text>");
            gauge3.setAnnotationValue(0, 0, "<text class='h4'>" + value03.toFixed(2) + " A</text>");
            gauge4.setAnnotationValue(0, 0, "<text class='h4'>" + value04.toFixed(1) + " V</text>");
            gauge5.setAnnotationValue(0, 0, "<text class='h4'>" + value05.toFixed(1) + " V</text>");
            gauge6.setAnnotationValue(0, 0, "<text class='h4'>" + value06.toFixed(1) + " V</text>");
            gauge7.setAnnotationValue(0, 0, "<text class='h4'>" + value07.toFixed(1) + " V</text>");
            gauge8.setAnnotationValue(0, 0, "<text class='h4'>" + value08.toFixed(1) + " V</text>");
            gauge9.setAnnotationValue(0, 0, "<text class='h4'>" + value09.toFixed(1) + " V</text>");
            gauge10.setAnnotationValue(0, 0, "<text class='h4'>" + value10.toFixed(3) + " kWh</text>");
            gauge11.setAnnotationValue(0, 0, "<text class='h4'>" + value11.toFixed(3) + " kVA</text>");
            gauge12.setAnnotationValue(0, 0, "<text class='h4'>" + value12.toFixed(3) + " kvar</text>");
            gauge13.setAnnotationValue(0, 0, "<text class='h4'>" + value13.toFixed(2) + "</text >");
            gauge14.setAnnotationValue(0, 0, "<text class='h4'>" + value14.toFixed(2) + " Hz</text>");
            gauge15.setAnnotationValue(0, 0, "<text class='h4'>" + value15.toFixed(5) + " GWh</text>");

            gauge1.setPointerValue(0, 0, value01);
            gauge2.setPointerValue(0, 0, value02);
            gauge3.setPointerValue(0, 0, value03);
            gauge4.setPointerValue(0, 0, value04);
            gauge5.setPointerValue(0, 0, value05);
            gauge6.setPointerValue(0, 0, value06);
            gauge7.setPointerValue(0, 0, value07);
            gauge8.setPointerValue(0, 0, value08);
            gauge9.setPointerValue(0, 0, value09);
            gauge10.setPointerValue(0, 0, value10);
            gauge11.setPointerValue(0, 0, value11);
            gauge12.setPointerValue(0, 0, value12);
            gauge13.setPointerValue(0, 0, value13);
            gauge14.setPointerValue(0, 0, value14);
            gauge15.setPointerValue(0, 0, value15);
        });

        connection.start()
            .then(function () {
                connection.invoke('UpdateInverter')
                    .catch(error => {
                        console.log('Invocation of UpdateInverter failed. Error: ' + error);
                        alert('Update failed with error: ' + error);
                    });
            })
            .catch(error => {
                console.log('Could not connect to SignalR server. Error: ' + error);
                alert('Could not connect to monitor hub.');
            });

    </script>
}
