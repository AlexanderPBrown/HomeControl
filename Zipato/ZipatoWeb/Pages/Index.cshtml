@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}
@using Syncfusion.EJ2;
@{
    var TitleFont = new Syncfusion.EJ2.CircularGauge.CircularGaugeFont
    {
        Size = "24px"
    };
}

<div class="container">

    <div class="text-center">
        <h1 class="display-4">Zipato Home Control</h1>
    </div>

    <br />
    <h1><small>Plugs</small></h1>

    <div class="row">
        <div class="col-sm-4 col-xs-1">
            <div class="content-wrapper">
                <ejs-circulargauge id="Gauge01" title="Power Plug 1" description="" titleStyle="TitleFont">
                    <e-circulargauge-axes>
                        <e-circulargauge-axis minimum="0" maximum="2500">
                            <e-axis-annotations>
                                <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                            </e-axis-annotations>
                            <e-axis-minorticks color="transparent"></e-axis-minorticks>
                        </e-circulargauge-axis>
                    </e-circulargauge-axes>
                </ejs-circulargauge>
            </div>
        </div>

        <div class="col-sm-4 col-xs-1">
            <div class="content-wrapper">
                <ejs-circulargauge id="Gauge02" title="Power Plug 2" description="" titleStyle="TitleFont">
                    <e-circulargauge-axes>
                        <e-circulargauge-axis minimum="0" maximum="2500">
                            <e-axis-annotations>
                                <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                            </e-axis-annotations>
                            <e-axis-minorticks color="transparent"></e-axis-minorticks>
                        </e-circulargauge-axis>
                    </e-circulargauge-axes>
                </ejs-circulargauge>
            </div>
        </div>

        <div class="col-sm-4 col-xs-1">
            <div class="content-wrapper">
                <ejs-circulargauge id="Gauge03" title="Power Plug 3" description="" titleStyle="TitleFont">
                    <e-circulargauge-axes>
                        <e-circulargauge-axis minimum="0" maximum="2500">
                            <e-axis-annotations>
                                <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                            </e-axis-annotations>
                            <e-axis-minorticks color="transparent"></e-axis-minorticks>
                        </e-circulargauge-axis>
                    </e-circulargauge-axes>
                </ejs-circulargauge>
            </div>
        </div>
    </div>

    <br />

    <div class="row">
        <div class="col-sm-4 col-xs-1">
            <div class="content-wrapper">
                <ejs-circulargauge id="Gauge04" title="Power Plug 4" description="" titleStyle="TitleFont">
                    <e-circulargauge-axes>
                        <e-circulargauge-axis minimum="0" maximum="2500">
                            <e-axis-annotations>
                                <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                            </e-axis-annotations>
                            <e-axis-minorticks color="transparent"></e-axis-minorticks>
                        </e-circulargauge-axis>
                    </e-circulargauge-axes>
                </ejs-circulargauge>
            </div>
        </div>

        <div class="col-sm-4 col-xs-1">
            <div class="content-wrapper">
                <ejs-circulargauge id="Gauge05" title="Power Plug 5" description="" titleStyle="TitleFont">
                    <e-circulargauge-axes>
                        <e-circulargauge-axis minimum="0" maximum="2500">
                            <e-axis-annotations>
                                <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                            </e-axis-annotations>
                            <e-axis-minorticks color="transparent"></e-axis-minorticks>
                        </e-circulargauge-axis>
                    </e-circulargauge-axes>
                </ejs-circulargauge>
            </div>
        </div>

        <div class="col-sm-4 col-xs-1">
            <div class="content-wrapper">
                <ejs-circulargauge id="Gauge06" title="Power Plug 6" description="" titleStyle="TitleFont">
                    <e-circulargauge-axes>
                        <e-circulargauge-axis minimum="0" maximum="2500">
                            <e-axis-annotations>
                                <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                            </e-axis-annotations>
                            <e-axis-minorticks color="transparent"></e-axis-minorticks>
                        </e-circulargauge-axis>
                    </e-circulargauge-axes>
                </ejs-circulargauge>
            </div>
        </div>
    </div>


    <br />

    <div class="row">
        <div class="col-sm-4 col-xs-1">
            <div class="content-wrapper">
                <ejs-circulargauge id="Gauge07" title="Power Plug 7" description="" titleStyle="TitleFont">
                    <e-circulargauge-axes>
                        <e-circulargauge-axis minimum="0" maximum="2500">
                            <e-axis-annotations>
                                <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                            </e-axis-annotations>
                            <e-axis-minorticks color="transparent"></e-axis-minorticks>
                        </e-circulargauge-axis>
                    </e-circulargauge-axes>
                </ejs-circulargauge>
            </div>
        </div>

        <div class="col-sm-4 col-xs-1">
            <div class="content-wrapper">
                <ejs-circulargauge id="Gauge08" title="Power Plug 8" description="" titleStyle="TitleFont">
                    <e-circulargauge-axes>
                        <e-circulargauge-axis minimum="0" maximum="2500">
                            <e-axis-annotations>
                                <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                            </e-axis-annotations>
                            <e-axis-minorticks color="transparent"></e-axis-minorticks>
                        </e-circulargauge-axis>
                    </e-circulargauge-axes>
                </ejs-circulargauge>
            </div>
        </div>

        <div class="col-sm-4 col-xs-1">
            <div class="content-wrapper">
                <ejs-circulargauge id="Gauge09" title="Heavy Duty Switch" description="" titleStyle="TitleFont">
                    <e-circulargauge-axes>
                        <e-circulargauge-axis minimum="0" maximum="3500">
                            <e-axis-annotations>
                                <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                            </e-axis-annotations>
                            <e-axis-minorticks color="transparent"></e-axis-minorticks>
                        </e-circulargauge-axis>
                    </e-circulargauge-axes>
                </ejs-circulargauge>
            </div>
        </div>

    </div>

    <br />
    <h1><small>Temperature</small></h1>

    <div class="row">
        <div class="col-sm-4 col-xs-1">
            <div class="content-wrapper">
                <ejs-circulargauge id="Gauge10" title="Thermostat 1" description="Thermostat (Dining Area)" titleStyle="TitleFont">
                    <e-circulargauge-axes>
                        <e-circulargauge-axis minimum="0" maximum="40">
                            <e-axis-annotations>
                                <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                            </e-axis-annotations>
                            <e-axis-minorticks color="transparent"></e-axis-minorticks>
                        </e-circulargauge-axis>
                    </e-circulargauge-axes>
                </ejs-circulargauge>
            </div>
        </div>

        <div class="col-sm-4 col-xs-1">
            <div class="content-wrapper">
                <ejs-circulargauge id="Gauge11" title="Thermostat 2" description="Thermostat (Hallway)" titleStyle="TitleFont">
                    <e-circulargauge-axes>
                        <e-circulargauge-axis minimum="0" maximum="40">
                            <e-axis-annotations>
                                <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                            </e-axis-annotations>
                            <e-axis-minorticks color="transparent"></e-axis-minorticks>
                        </e-circulargauge-axis>
                    </e-circulargauge-axes>
                </ejs-circulargauge>
            </div>
        </div>

        <div class="col-sm-4 col-xs-1">
            <div class="content-wrapper">
                <ejs-circulargauge id="Gauge12" title="Thermostat 3" description="Thermostat (Bathroom)" titleStyle="TitleFont">
                    <e-circulargauge-axes>
                        <e-circulargauge-axis minimum="0" maximum="40">
                            <e-axis-annotations>
                                <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                            </e-axis-annotations>
                            <e-axis-minorticks color="transparent"></e-axis-minorticks>
                        </e-circulargauge-axis>
                    </e-circulargauge-axes>
                </ejs-circulargauge>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-sm-4 col-xs-1">
            <div class="content-wrapper">
                <ejs-circulargauge id="Gauge13" title="Thermostat 4" description="Thermostat (Guest Room)" titleStyle="TitleFont">
                    <e-circulargauge-axes>
                        <e-circulargauge-axis minimum="0" maximum="40">
                            <e-axis-annotations>
                                <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                            </e-axis-annotations>
                            <e-axis-minorticks color="transparent"></e-axis-minorticks>
                        </e-circulargauge-axis>
                    </e-circulargauge-axes>
                </ejs-circulargauge>
            </div>
        </div>

        <div class="col-sm-4 col-xs-1">
            <div class="content-wrapper">
                <ejs-circulargauge id="Gauge14" title="Smoke Sensor" description="Smoke Sensor" titleStyle="TitleFont">
                    <e-circulargauge-axes>
                        <e-circulargauge-axis minimum="0" maximum="40">
                            <e-axis-annotations>
                                <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                            </e-axis-annotations>
                            <e-axis-minorticks color="transparent"></e-axis-minorticks>
                        </e-circulargauge-axis>
                    </e-circulargauge-axes>
                </ejs-circulargauge>
            </div>
        </div>

        <div class="col-sm-4 col-xs-1">
            <div class="content-wrapper">
                <ejs-circulargauge id="Gauge15" title="Flood Sensor" description="Flood Sensor" titleStyle="TitleFont">
                    <e-circulargauge-axes>
                        <e-circulargauge-axis minimum="0" maximum="40">
                            <e-axis-annotations>
                                <e-axis-annotation angle="180" radius="120%" content=""></e-axis-annotation>
                            </e-axis-annotations>
                            <e-axis-minorticks color="transparent"></e-axis-minorticks>
                        </e-circulargauge-axis>
                    </e-circulargauge-axes>
                </ejs-circulargauge>
            </div>
        </div>
    </div>

    <div class="text-center">
        <hr/>
        <text class="h6" id="message">Zipato Home Control</text>
    </div>

</div>

<script src="~/lib/signalr/signalr.js"></script>
<script>
    var gauge1, gauge2, gauge3;
    var gauge4, gauge5, gauge6;
    var gauge7, gauge8, gauge9;
    var gauge10, gauge11, gauge12;
    var gauge13, gauge14, gauge15;

    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/hubs/monitor")
        .configureLogging(signalR.LogLevel.Trace)
        .build();

    connection.on('UpdateSensors', function (data) {
        if (!gauge1)
            gauge1 = document.getElementById("Gauge01").ej2_instances[0];
        if (!gauge2)
            gauge2 = document.getElementById("Gauge02").ej2_instances[0];
        if (!gauge3)
            gauge3 = document.getElementById("Gauge03").ej2_instances[0];
        if (!gauge4)
            gauge4 = document.getElementById("Gauge04").ej2_instances[0];
        if (!gauge5)
            gauge5 = document.getElementById("Gauge05").ej2_instances[0];
        if (!gauge6)
            gauge6 = document.getElementById("Gauge06").ej2_instances[0];
        if (!gauge7)
            gauge7 = document.getElementById("Gauge07").ej2_instances[0];
        if (!gauge8)
            gauge8 = document.getElementById("Gauge08").ej2_instances[0];
        if (!gauge9)
            gauge9 = document.getElementById("Gauge09").ej2_instances[0];
        if (!gauge10)
            gauge10 = document.getElementById("Gauge10").ej2_instances[0];
        if (!gauge11)
            gauge11 = document.getElementById("Gauge11").ej2_instances[0];
        if (!gauge12)
            gauge12 = document.getElementById("Gauge12").ej2_instances[0];
        if (!gauge13)
            gauge13 = document.getElementById("Gauge13").ej2_instances[0];
        if (!gauge14)
            gauge14 = document.getElementById("Gauge14").ej2_instances[0];
        if (!gauge15)
            gauge15 = document.getElementById("Gauge15").ej2_instances[0];

        value01 = data.consumptionMeters[0].currentConsumption.value;  // Plug 1
        value02 = data.consumptionMeters[1].currentConsumption.value;  // Plug 2
        value03 = data.consumptionMeters[2].currentConsumption.value;  // Plug 3
        value04 = data.consumptionMeters[3].currentConsumption.value;  // Plug 4
        value05 = data.consumptionMeters[4].currentConsumption.value;  // Plug 5
        value06 = data.consumptionMeters[5].currentConsumption.value;  // Plug 6
        value07 = data.consumptionMeters[6].currentConsumption.value;  // Plug 7
        value08 = data.consumptionMeters[7].currentConsumption.value;  // Plug 8
        value09 = data.consumptionMeters[8].currentConsumption.value;  // Heavy Duty Switch
        value10 = data.temperatureSensors[5].temperature.value;  // Thermostat 1
        value11 = data.temperatureSensors[6].temperature.value;  // Thermostat 2
        value12 = data.temperatureSensors[7].temperature.value;  // Thermostat 3
        value13 = data.temperatureSensors[8].temperature.value;  // Thermostat 4
        value14 = data.temperatureSensors[2].temperature.value;  // Smoke Sensor
        value15 = data.temperatureSensors[4].temperature.value;  // Flood Sensor

        gauge1.setAnnotationValue(0, 0, "<text class='h4'>" + value01.toFixed(0) + " W</text>");
        gauge2.setAnnotationValue(0, 0, "<text class='h4'>" + value02.toFixed(0) + " W</text>");
        gauge3.setAnnotationValue(0, 0, "<text class='h4'>" + value03.toFixed(0) + " W</text>");
        gauge4.setAnnotationValue(0, 0, "<text class='h4'>" + value04.toFixed(0) + " W</text>");
        gauge5.setAnnotationValue(0, 0, "<text class='h4'>" + value05.toFixed(0) + " W</text>");
        gauge6.setAnnotationValue(0, 0, "<text class='h4'>" + value06.toFixed(0) + " W</text>");
        gauge7.setAnnotationValue(0, 0, "<text class='h4'>" + value07.toFixed(0) + " W</text>");
        gauge8.setAnnotationValue(0, 0, "<text class='h4'>" + value08.toFixed(0) + " W</text>");
        gauge9.setAnnotationValue(0, 0, "<text class='h4'>" + value09.toFixed(0) + " W</text>");
        gauge10.setAnnotationValue(0, 0, "<text class='h4'>" + value10.toFixed(1) + " °C</text>");
        gauge11.setAnnotationValue(0, 0, "<text class='h4'>" + value11.toFixed(1) + " °C</text>");
        gauge12.setAnnotationValue(0, 0, "<text class='h4'>" + value12.toFixed(1) + " °C</text>");
        gauge13.setAnnotationValue(0, 0, "<text class='h4'>" + value13.toFixed(1) + " °C</text>");
        gauge14.setAnnotationValue(0, 0, "<text class='h4'>" + value14.toFixed(1) + " °C</text>");
        gauge15.setAnnotationValue(0, 0, "<text class='h4'>" + value15.toFixed(1) + " °C</text>");

        gauge1.setPointerValue(0, 0, value01);
        gauge2.setPointerValue(0, 0, value02);
        gauge3.setPointerValue(0, 0, value03);
        gauge4.setPointerValue(0, 0, value04);
        gauge5.setPointerValue(0, 0, value05);
        gauge6.setPointerValue(0, 0, value06);
        gauge7.setPointerValue(0, 0, value07);
        gauge8.setPointerValue(0, 0, value08);
        gauge9.setPointerValue(0, 0, value09);
        gauge10.setPointerValue(0, 0, value10);
        gauge11.setPointerValue(0, 0, value11);
        gauge12.setPointerValue(0, 0, value12);
        gauge13.setPointerValue(0, 0, value13);
        gauge14.setPointerValue(0, 0, value14);
        gauge15.setPointerValue(0, 0, value15);

        var dt = new Date();
        var time = dt.getHours() + ":" + dt.getMinutes() + ":" + dt.getSeconds();

        if (data.status.code == 0) {
            message.textContent = "Last updated at " + time;
        }
        else {
            message.textContent = time + ": " + data.status.name + " - " + data.status.explanation;
        }
    });

    connection.start()
        .then(function () {
            connection.invoke('UpdateValues')
                .catch(error => {
                    console.log('Invocation of UpdateValues failed. Error: ' + error);
                    alert('Update failed with error: ' + error);
                });
        })
        .catch(error => {
            console.log('Could not connect to SignalR server. Error: ' + error);
            alert('Could not connect to monitor hub.');
        });

</script>

